openapi: 3.1.0
info:
  title: SEP-24 Interactive Deposit and Withdrawal
  version: 1.1.0
  description: API contract for SEP-24 interactive anchor flows implemented by this repository.
servers:
  - url: https://example.com/sep24
security:
  - sep10Auth: []
paths:
  /info:
    get:
      operationId: getInfo
      summary: Get anchor capabilities
      security: []
      responses:
        '200':
          description: Anchor info
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InfoResponse'
  /transactions/deposit/interactive:
    post:
      operationId: createDepositInteractive
      summary: Create interactive deposit transaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InteractiveRequest'
      responses:
        '200':
          description: Interactive URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InteractiveResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
  /transactions/withdraw/interactive:
    post:
      operationId: createWithdrawInteractive
      summary: Create interactive withdrawal transaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InteractiveRequest'
      responses:
        '200':
          description: Interactive URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InteractiveResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
  /transaction:
    get:
      operationId: getTransaction
      summary: Get a single transaction
      description: |
        At least one of `id`, `external_transaction_id`, or `stellar_transaction_id` must be provided.
      parameters:
        - in: query
          name: id
          required: false
          schema:
            type: string
        - in: query
          name: external_transaction_id
          required: false
          schema:
            type: string
        - in: query
          name: stellar_transaction_id
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Transaction
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  /transactions:
    get:
      operationId: listTransactions
      summary: List transactions for authenticated account
      parameters:
        - in: query
          name: asset_code
          required: false
          schema:
            type: string
        - in: query
          name: kind
          required: false
          schema:
            type: string
            enum: [deposit, withdrawal]
        - in: query
          name: no_older_than
          required: false
          schema:
            type: string
            format: date-time
        - in: query
          name: limit
          required: false
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: Transactions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
  /fee:
    get:
      operationId: getFee
      summary: Get fee estimate
      parameters:
        - in: query
          name: operation
          required: true
          schema:
            type: string
            enum: [deposit, withdraw]
        - in: query
          name: asset_code
          required: true
          schema:
            type: string
        - in: query
          name: amount
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Fee quote
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeeResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
components:
  securitySchemes:
    sep10Auth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    AssetCapability:
      type: object
      required: [enabled]
      additionalProperties: false
      properties:
        enabled:
          type: boolean
        fee_fixed:
          type: number
        fee_percent:
          type: number
        fee_minimum:
          type: number
        min_amount:
          type: number
        max_amount:
          type: number
    FeeConfig:
      type: object
      required: [enabled]
      properties:
        enabled:
          type: boolean
        authentication_required:
          type: boolean
    InfoResponse:
      type: object
      required: [deposit, withdraw, fee]
      properties:
        deposit:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/AssetCapability'
        withdraw:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/AssetCapability'
        fee:
          $ref: '#/components/schemas/FeeConfig'
    InteractiveRequest:
      type: object
      required: [asset_code]
      properties:
        asset_code:
          type: string
        account:
          type: string
          description: Optional. If provided, must match the SEP-10 token subject.
        amount:
          type: string
        lang:
          type: string
    InteractiveResponse:
      type: object
      required: [id, type, url]
      properties:
        id:
          type: string
        type:
          type: string
          enum: [interactive_customer_info_needed]
        url:
          type: string
          format: uri
    TransactionBase:
      type: object
      required: [id, kind, status, more_info_url, started_at]
      properties:
        id:
          type: string
        kind:
          type: string
          enum: [deposit, withdrawal]
        status:
          type: string
          enum:
            - incomplete
            - pending_anchor
            - pending_external
            - pending_stellar
            - pending_trust
            - pending_user
            - pending_user_transfer_start
            - pending_user_transfer_complete
            - completed
            - refunded
            - expired
            - no_market
            - too_small
            - too_large
            - error
        status_eta:
          type: [number, 'null']
        kyc_verified:
          type: [boolean, 'null']
        more_info_url:
          type: string
          format: uri
        amount_in:
          type: [string, 'null']
        amount_in_asset:
          type: [string, 'null']
        amount_out:
          type: [string, 'null']
        amount_out_asset:
          type: [string, 'null']
        amount_fee:
          type: [string, 'null']
        amount_fee_asset:
          type: [string, 'null']
        started_at:
          type: string
          format: date-time
        completed_at:
          type: [string, 'null']
          format: date-time
        updated_at:
          type: [string, 'null']
          format: date-time
        stellar_transaction_id:
          type: [string, 'null']
        external_transaction_id:
          type: [string, 'null']
        message:
          type: [string, 'null']
        refunded:
          type: [boolean, 'null']
        refunds:
          type: [object, 'null']
    DepositTransaction:
      allOf:
        - $ref: '#/components/schemas/TransactionBase'
        - type: object
          required: [to]
          properties:
            kind:
              const: deposit
            to:
              type: string
            from:
              type: [string, 'null']
            deposit_memo:
              type: [string, 'null']
            deposit_memo_type:
              type: [string, 'null']
            claimable_balance_id:
              type: [string, 'null']
    WithdrawalTransaction:
      allOf:
        - $ref: '#/components/schemas/TransactionBase'
        - type: object
          required: [from]
          properties:
            kind:
              const: withdrawal
            from:
              type: string
            to:
              type: [string, 'null']
            withdraw_anchor_account:
              type: [string, 'null']
            withdraw_memo:
              type: [string, 'null']
            withdraw_memo_type:
              type: [string, 'null']
    TransactionResponse:
      type: object
      required: [transaction]
      properties:
        transaction:
          anyOf:
            - $ref: '#/components/schemas/DepositTransaction'
            - $ref: '#/components/schemas/WithdrawalTransaction'
    TransactionsResponse:
      type: object
      required: [transactions]
      properties:
        transactions:
          type: array
          items:
            anyOf:
              - $ref: '#/components/schemas/DepositTransaction'
              - $ref: '#/components/schemas/WithdrawalTransaction'
    FeeResponse:
      type: object
      required: [fee]
      properties:
        fee:
          type: number
    ErrorResponse:
      type: object
      required: [error]
      properties:
        error:
          type: string
  responses:
    BadRequest:
      description: Invalid request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Missing or invalid SEP-10 bearer token, or access forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
